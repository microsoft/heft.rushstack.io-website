"use strict";(self.webpackChunkheft_rushstack_io=self.webpackChunkheft_rushstack_io||[]).push([[6233],{158:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(6393);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},f="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),f=p(n),m=i,h=f["".concat(l,".").concat(m)]||f[m]||g[m]||r;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[f]="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7727:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>p,toc:()=>f});var a=n(9122),i=n(2501),r=(n(6393),n(158)),o=["components"],s={title:"Using rig packages"},l=void 0,p={unversionedId:"pages/intro/rig_packages",id:"pages/intro/rig_packages",title:"Using rig packages",description:"In a large scale environment, it's beneficial for many projects to be built using the exact same Heft configuration.",source:"@site/docs/pages/intro/rig_packages.md",sourceDirName:"pages/intro",slug:"/pages/intro/rig_packages",permalink:"/zh-cn/pages/intro/rig_packages",draft:!1,editUrl:"https://github.com/microsoft/rushstack-websites/tree/main/websites/heft.rushstack.io/docs/pages/intro/rig_packages.md",tags:[],version:"current",frontMatter:{title:"Using rig packages"},sidebar:"docsSidebar",previous:{title:"Heft architecture",permalink:"/zh-cn/pages/intro/architecture"},next:{title:"Heft command line",permalink:"/zh-cn/pages/intro/cli"}},c={},f=[{value:"Some concrete examples",id:"some-concrete-examples",level:2},{value:"Principles of rigging",id:"principles-of-rigging",level:2},{value:"1. Base files for <code>&quot;extends&quot;</code>",id:"1-base-files-for-extends",level:3},{value:"2. Riggable config files",id:"2-riggable-config-files",level:3},{value:"3. Riggable dependencies",id:"3-riggable-dependencies",level:3},{value:"See also",id:"see-also",level:2}],g={toc:f},m="wrapper";function h(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)(m,(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,'In a large scale environment, it\'s beneficial for many projects to be built using the exact same Heft configuration.\nThere may be some minor differences -- for example, a Node.js project may emit CommonJS modules, whereas a web application\nproject may need to emit ESNext modules. But generally a small handful of common "profiles" will cover most projects.\nThe ',(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@rushstack/rig-package"},"@rushstack/rig-package")," system provides a formalized\nmechanism for moving common settings into an NPM package which gets added to the ",(0,r.kt)("inlineCode",{parentName:"p"},'"devDependencies"')," for the projects\nthat consume it. This is called a ",(0,r.kt)("strong",{parentName:"p"},"rig package"),". Note that several different ",(0,r.kt)("strong",{parentName:"p"},"rig profiles")," may come from the\nsame NPM package; each profile is a folder containing a set of config files."),(0,r.kt)("h2",{id:"some-concrete-examples"},"Some concrete examples"),(0,r.kt)("p",null,"Heft also provides two standard rig packages that you can use in your projects:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/microsoft/rushstack/tree/main/rigs/heft-node-rig"},"@rushstack/heft-node-rig")," with a profile called ",(0,r.kt)("inlineCode",{parentName:"li"},"default")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/microsoft/rushstack/tree/main/rigs/heft-web-rig"},"@rushstack/heft-web-rig")," with profiles ",(0,r.kt)("inlineCode",{parentName:"li"},"app")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"library"))),(0,r.kt)("p",null,"It's also easy to define your own custom rig packages by following these examples."),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/microsoft/rushstack-samples/tree/main/heft/heft-node-rig-tutorial"},"heft-node-rig-tutorial"),"\nsample project illustrates how to consume ",(0,r.kt)("inlineCode",{parentName:"p"},"@rushstack/heft-node-rig"),"."),(0,r.kt)("h2",{id:"principles-of-rigging"},"Principles of rigging"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@rushstack/rig-package"},"@rushstack/rig-package"),' defines the "rigging" concept\nbut only provides an API for resolving file paths based on a ',(0,r.kt)("strong",{parentName:"p"},"rig.json")," config file. Retrofitting rigging\nonto existing tools requires extra logic beyond this API, and different implementations may be needed for different\ntools. Heft has already implemented such logic for its official plugins, but if you have projects that use some\nother toolchain besides Heft, you make them riggable by copying the same approaches as Heft."),(0,r.kt)("p",null,"Rigging involves three distinct features:"),(0,r.kt)("h3",{id:"1-base-files-for-extends"},"1. Base files for ",(0,r.kt)("inlineCode",{parentName:"h3"},'"extends"')),(0,r.kt)("p",null,"Many config files provide a facility for inheriting shared settings from another file,\nwhich is an easy way to reuse configuration from a rig. For example, in our sample project,\nthe TypeScript configuration is reduced to just a few lines:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"heft-node-rig-tutorial/tsconfig.json")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "extends": "./node_modules/@rushstack/heft-node-rig/profiles/default/tsconfig-base.json",\n  "compilerOptions": {\n    "types": ["heft-jest", "node"]\n  }\n}\n')),(0,r.kt)("p",null,"The bulk of the settings come from ",(0,r.kt)("inlineCode",{parentName:"p"},"tsconfig-base.json")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," profile. But our local ",(0,r.kt)("strong",{parentName:"p"},"tsconfig.json"),"\nfile can add custom settings such as ",(0,r.kt)("inlineCode",{parentName:"p"},'"types"')," as needed."),(0,r.kt)("p",null,"The following config files all support a field such as ",(0,r.kt)("inlineCode",{parentName:"p"},'"extends"')," that enables settings to be inherited from another NPM package:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},".eslintrc.js")," for the ",(0,r.kt)("a",{parentName:"li",href:"/zh-cn/pages/plugins/lint"},"lint task"),", provided that you use the ",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@rushstack/eslint-patch"},"@rushstack/eslint-patch")," workaround or the ",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@rushstack/eslint-config"},"@rushstack/eslint-config")," ruleset (which includes the patch)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"config/api-extractor.json")," for the ",(0,r.kt)("a",{parentName:"li",href:"/zh-cn/pages/plugins/api-extractor"},"api-extractor task")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"config/jest.config.json")," for the ",(0,r.kt)("a",{parentName:"li",href:"/zh-cn/pages/plugins/jest"},"jest task"),"; Jest conventionally uses the ",(0,r.kt)("inlineCode",{parentName:"li"},'"preset"')," field for inheritance however it has some problems, so Heft replaces Jest's config loader with ",(0,r.kt)("inlineCode",{parentName:"li"},"@rushstack/heft-config-file")," engine, and then we use ",(0,r.kt)("inlineCode",{parentName:"li"},'"extends"')," instead of ",(0,r.kt)("inlineCode",{parentName:"li"},'"preset"'),". In all other respects, this file has the standard Jest format."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tsconfig.json")," for the ",(0,r.kt)("a",{parentName:"li",href:"/zh-cn/pages/plugins/typescript"},"typescript task")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"webpack.config.js")," does not explicitly support inheritance, but being a JavaScript module, it can call ",(0,r.kt)("inlineCode",{parentName:"li"},"require()")," to load shared settings.")),(0,r.kt)("h3",{id:"2-riggable-config-files"},"2. Riggable config files"),(0,r.kt)("p",null,"Although ",(0,r.kt)("inlineCode",{parentName:"p"},'"extends"')," makes files smaller, it cannot eliminate them entirely. The ",(0,r.kt)("strong",{parentName:"p"},"rig.json"),' file\ncan completely eliminate most Heft config files. We say that such files are "riggable" config files.\nHere\'s an example from the ',(0,r.kt)("inlineCode",{parentName:"p"},"heft-node-rig-tutorial")," project:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"heft-node-rig-tutorial/config/rig.json")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// The "rig.json" file directs tools to look for their config files in an external package.\n// Documentation for this system: https://www.npmjs.com/package/@rushstack/rig-package\n{\n  "$schema": "https://developer.microsoft.com/json-schemas/rig-package/rig.schema.json",\n\n  /**\n   * (Required) The name of the rig package to inherit from.\n   * It should be an NPM package name with the "-rig" suffix.\n   */\n  "rigPackageName": "@rushstack/heft-node-rig"\n\n  /**\n   * (Optional) Selects a config profile from the rig package.  The name must consist of\n   * lowercase alphanumeric words separated by hyphens, for example "sample-profile".\n   * If omitted, then the "default" profile will be used."\n   */\n  // "rigProfile": "your-profile-name"\n}\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"rig.json")," file tells Heft that if it doesn't find a file in the ",(0,r.kt)("strong",{parentName:"p"},"heft-node-rig-tutorial/config"),", it should\ntry looking in the ",(0,r.kt)("strong",{parentName:"p"},"@rushstack/heft-node-rig/profiles/default/common")," folder instead."),(0,r.kt)("p",null,'Examples of "riggable" config files:'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"<","project folder",">","/config/api-extractor-task.json")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"<","project folder",">","/config/heft.json")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"<","project folder",">","/config/typescript.json"))),(0,r.kt)("p",null,"We cannot eliminate ",(0,r.kt)("strong",{parentName:"p"},"tsconfig.json")," entirely because tools such as VS Code expect to find this file in\nthe root of your project folder. This is true of a few other files such as ",(0,r.kt)("strong",{parentName:"p"},".eslintrc.js"),". On this website,\nthe documentation for each config file specifies whether it is riggable or not."),(0,r.kt)("h3",{id:"3-riggable-dependencies"},"3. Riggable dependencies"),(0,r.kt)("p",null,"A rig package can also provide NPM dependencies, to avoid having to specify them as ",(0,r.kt)("inlineCode",{parentName:"p"},'"devDependencies"')," for\nyour project. The following tool packages can be provided by the rig (provided they aren't required as\n",(0,r.kt)("inlineCode",{parentName:"p"},"peerDependencies")," of some other project dependency):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"@microsoft/api-extractor")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"eslint")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"jest")," and related packages"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"tslint")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"typescript")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"webpack")," and its loaders and plugins")),(0,r.kt)("p",null,"Providing dependencies via a rig is optional. Your local project's ",(0,r.kt)("inlineCode",{parentName:"p"},"devDependencies")," take precedence over the rig."),(0,r.kt)("p",null,"Heft resolves each riggable tool independently, using the following procedure:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If the tool package is listed in the ",(0,r.kt)("inlineCode",{parentName:"p"},"devDependencies")," for the local project, then the tool is resolved from\nthe current project folder. (This step does NOT consider ",(0,r.kt)("inlineCode",{parentName:"p"},"dependencies")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"peerDependencies"),".)")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"OTHERWISE, if the current project has a ",(0,r.kt)("strong",{parentName:"p"},"rig.json")," file, and if the rig's ",(0,r.kt)("strong",{parentName:"p"},"package.json")," lists the tool in its\n",(0,r.kt)("inlineCode",{parentName:"p"},"dependencies"),", then the tool is resolved from the rig package folder. (This step does NOT consider\n",(0,r.kt)("inlineCode",{parentName:"p"},"devDependencies")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"peerDependencies"),".)")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"OTHERWISE, the tool is resolved from the current project folder. If it can't be found there, then an error\nis reported."))),(0,r.kt)("h2",{id:"see-also"},"See also"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@rushstack/rig-package"},"@rushstack/rig-package")," documentation provides the complete specification for the ",(0,r.kt)("strong",{parentName:"li"},"rig.json")," system"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/microsoft/rushstack-samples/tree/main/heft/heft-node-rig-tutorial"},"heft-node-rig-tutorial")," sample project")))}h.isMDXComponent=!0}}]);